
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusNet-LC íì•” ì§„ë‹¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .upload-section {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }
        
        .file-input {
            display: none;
        }
        
        .file-input-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-input-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .predict-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            cursor: pointer;
            margin-left: 20px;
            transition: all 0.3s;
        }
        
        .predict-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .predict-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .results-section {
            display: none;
            margin-top: 40px;
        }
        
        .prediction-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .prediction-result {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .confidence {
            font-size: 1.5em;
            margin-bottom: 20px;
        }
        
        .all-predictions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .prediction-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .images-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .image-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .image-card h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .image-card img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .doctor-section {
            display: none;
            background: #fff9e6;
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }
        
        .doctor-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
            color: #856404;
            font-weight: bold;
        }
        
        .doctor-form {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .form-group select, .form-group textarea, .form-group input[type="date"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-group input[type="radio"] {
            margin-right: 10px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .radio-option:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }
        
        .radio-option input[type="radio"]:checked + span {
            color: #007bff;
            font-weight: bold;
        }
        
        .submit-doctor-button {
            background: linear-gradient(135deg, #ffc107, #ff8f00);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        
        .submit-doctor-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .survey-section {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }
        
        .survey-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
        }
        
        .survey-form {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .survey-form .form-group input[type="radio"] {
            margin-right: 10px;
        }
        
        .survey-form .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .survey-form .radio-option {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #ddd;
        }
        
        .survey-form .radio-option:hover {
            background: #e9ecef;
        }
        
        .survey-form input[type="number"], .survey-form input[type="date"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .submit-survey-button {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        
        .submit-survey-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .recommendations-section {
            display: none;
            margin-top: 30px;
        }
        
        .recommendations-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .priority-banner {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .priority-low {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .priority-medium {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }
        
        .priority-high {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .priority-urgent {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .ai-vs-doctor {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        
        .diagnosis-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .diagnosis-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .agreement-status {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .agreement-true {
            background: #d4edda;
            color: #155724;
        }
        
        .agreement-false {
            background: #f8d7da;
            color: #721c24;
        }
        
        .appointment-card {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        
        .appointment-confirmed {
            color: #155724;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .recommendation-category {
            margin-bottom: 25px;
        }
        
        .recommendation-category h4 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #ddd;
        }
        
        .recommendation-list {
            list-style: none;
            padding: 0;
        }
        
        .recommendation-list li {
            background: white;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .recommendation-list li:before {
            content: "âœ“ ";
            color: #28a745;
            font-weight: bold;
            margin-right: 8px;
        }
        
        .smoking-advice li {
            border-left-color: #dc3545;
        }
        
        .exercise-advice li {
            border-left-color: #28a745;
        }
        
        .medical-advice li {
            border-left-color: #ffc107;
        }
        
        .lifestyle-advice li {
            border-left-color: #17a2b8;
        }
        
        .followup-advice li {
            border-left-color: #6f42c1;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #dc3545;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }
        
        .admin-message {
            background: #ffc107;
            color: #856404;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            text-align: center;
        }
        
        .admin-message h4 {
            margin-bottom: 10px;
            color: #856404;
        }
        
        @media (max-width: 768px) {
            .images-container {
                grid-template-columns: 1fr;
            }
            
            .predict-button {
                margin-left: 0;
                margin-top: 10px;
            }
            
            .radio-group {
                flex-direction: column;
            }
            
            .diagnosis-comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI Bread Scan</h1>
            <p>AI ê¸°ë°˜ íì•” ì§„ë‹¨ ì‹œìŠ¤í…œ (ì„œê°•ëŒ€ AISW í…ì„œí”Œë¡œ í™œìš©ê¸°ì´ˆ)</p>
        </div>
        
        <div class="content">
            <div class="upload-section">
                <h2>CT ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</h2>
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" class="file-input" accept=".png,.jpg,.jpeg">
                    <button class="file-input-button" onclick="document.getElementById('fileInput').click()">
                        ğŸ“ íŒŒì¼ ì„ íƒ
                    </button>
                </div>
                <button class="predict-button" id="predictButton" disabled onclick="predict()">
                    ğŸ” ì§„ë‹¨ ì‹œì‘
                </button>
                <div id="fileName" style="margin-top: 10px; color: #666;"></div>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>AIê°€ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            
            <div class="admin-message" id="adminMessage">
                <h4>âš ï¸ ì „ì²˜ë¦¬ ì‹¤íŒ¨</h4>
                <p id="adminMessageText"></p>
            </div>
            
            <div class="results-section" id="resultsSection">
                <div class="prediction-card">
                    <div class="prediction-result" id="predictionResult"></div>
                    <div class="confidence" id="confidence"></div>
                    <div class="all-predictions" id="allPredictions"></div>
                </div>
                
                <div class="images-container">
                    <div class="image-card">
                        <h3>ğŸ“· ì›ë³¸ ì´ë¯¸ì§€</h3>
                        <img id="originalImage" src="" alt="ì›ë³¸ ì´ë¯¸ì§€">
                    </div>
                    <div class="image-card">
                        <h3>ğŸ” ì „ì²˜ë¦¬ëœ ì´ë¯¸ì§€</h3>
                        <img id="processedImage" src="" alt="ì „ì²˜ë¦¬ëœ ì´ë¯¸ì§€">
                    </div>
                    <div class="image-card">
                        <h3>ğŸ¯ Grad-CAM íˆíŠ¸ë§µ</h3>
                        <img id="gradcamImage" src="" alt="Grad-CAM íˆíŠ¸ë§µ">
                    </div>
                </div>
            </div>
            
            <!-- ì˜ì‚¬ ì§„ë‹¨ ì„¹ì…˜ -->
            <div class="doctor-section" id="doctorSection">
                <h3 class="doctor-title">ğŸ©º ì˜ì‚¬ ì§„ë‹¨ ë° ì†Œê²¬</h3>
                <p style="text-align: center; margin-bottom: 30px; color: #856404;">
                    AI ë¶„ì„ ê²°ê³¼ë¥¼ ê²€í† í•˜ì‹œê³  ìµœì¢… ì§„ë‹¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                </p>
                
                <form class="doctor-form" id="doctorForm">
                    <div class="form-group">
                        <label>ìµœì¢… ì§„ë‹¨ ê²°ê³¼</label>
                        <select name="final_diagnosis" required>
                            <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                            <option value="Normal">ì •ìƒ (Normal)</option>
                            <option value="Benign">ì–‘ì„± ë³‘ë³€ (Benign)</option>
                            <option value="Malignant">ì•…ì„± ë³‘ë³€ (Malignant)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>ì˜ì‚¬ ì†Œê²¬ ë° ì¶”ê°€ ì˜ê²¬</label>
                        <textarea name="notes" placeholder="ì§„ë‹¨ ì†Œê²¬, ì¶”ê°€ ê²€ì‚¬ í•„ìš”ì„±, ì£¼ì˜ì‚¬í•­ ë“±ì„ ì…ë ¥í•´ì£¼ì„¸ìš”..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>ë‹¤ìŒ ì§„ë£Œ í•„ìš” ì—¬ë¶€</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="next_visit_needed" value="false" required>
                                <span>ë¶ˆí•„ìš” (ì •ê¸° ê²€ì§„ìœ¼ë¡œ ì¶©ë¶„)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="next_visit_needed" value="true" required>
                                <span>í•„ìš” (ì¶”ì  ê´€ì°° ë˜ëŠ” ì •ë°€ê²€ì‚¬)</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group" id="nextVisitDateGroup" style="display: none;">
                        <label>ê¶Œì¥ ë‹¤ìŒ ì§„ë£Œì¼</label>
                        <input type="date" name="next_visit_date" min="">
                    </div>
                    
                    <button type="submit" class="submit-doctor-button">
                        ğŸ’¾ ì§„ë‹¨ ì™„ë£Œ
                    </button>
                </form>
            </div>
            
            <!-- ì„¤ë¬¸ì¡°ì‚¬ ì„¹ì…˜ -->
            <div class="survey-section" id="surveySection">
                <h3 class="survey-title">ğŸ“‹ ê±´ê°• ì„¤ë¬¸ì¡°ì‚¬ ë° ì˜ˆì•½</h3>
                <p style="text-align: center; margin-bottom: 30px; color: #666;">
                    ë” ì •í™•í•œ ê±´ê°• ê¶Œê³ ì‚¬í•­ì„ ìœ„í•´ ê°„ë‹¨í•œ ì„¤ë¬¸ì— ì°¸ì—¬í•´ì£¼ì„¸ìš”.
                </p>
                
                <form class="survey-form" id="surveyForm">
                    <div class="form-group">
                        <label>1. í˜„ì¬ í¡ì—° ìƒíƒœëŠ” ì–´ë– ì‹ ê°€ìš”?</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="smoking" value="false" required>
                                <span>ğŸš­ ë¹„í¡ì—°ì (í¡ì—°í•œ ì  ì—†ìŒ)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="smoking" value="false" required>
                                <span>ğŸš« ê¸ˆì—°ì (ê³¼ê±° í¡ì—°, í˜„ì¬ ê¸ˆì—°)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="smoking" value="true" required>
                                <span>ğŸš¬ í˜„ì¬ í¡ì—°ì</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>2. í‰ì†Œ ìš´ë™ì€ ì–¼ë§ˆë‚˜ ìì£¼ í•˜ì‹œë‚˜ìš”?</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="exercise" value="0" required>
                                <span>ğŸ˜´ ìš´ë™ì„ ê±°ì˜ í•˜ì§€ ì•ŠìŒ</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="exercise" value="1" required>
                                <span>ğŸš¶â€â™‚ï¸ ê°€ë” ìš´ë™í•¨ (ì£¼ 1-2íšŒ)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="exercise" value="2" required>
                                <span>ğŸƒâ€â™‚ï¸ ì •ê¸°ì ìœ¼ë¡œ ìš´ë™í•¨ (ì£¼ 3íšŒ ì´ìƒ)</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="age">3. ì—°ë ¹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:</label>
                        <input type="number" id="age" name="age" min="1" max="120" value="40" required>
                    </div>
                    
                    <div class="form-group" id="appointmentGroup" style="display: none;">
                        <label for="appointment_date">4. ë‹¤ìŒ ì§„ë£Œ ì˜ˆì•½ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”:</label>
                        <input type="date" id="appointment_date" name="appointment_date" min="">
                    </div>
                    
                    <button type="submit" class="submit-survey-button">
                        ğŸ“Š ê±´ê°• ê¶Œê³ ì‚¬í•­ ë°›ê¸°
                    </button>
                </form>
            </div>
            
            <!-- ê±´ê°• ê¶Œê³ ì‚¬í•­ ì„¹ì…˜ -->
            <div class="recommendations-section" id="recommendationsSection">
                <div class="recommendations-card">
                    <h3 style="text-align: center; margin-bottom: 20px; color: #333;">
                        ğŸ’¡ ê°œì¸í™”ëœ ê±´ê°• ê¶Œê³ ì‚¬í•­
                    </h3>
                    
                    <div id="priorityBanner" class="priority-banner"></div>
                    
                    <!-- AI vs ì˜ì‚¬ ì§„ë‹¨ ë¹„êµ -->
                    <div id="aiVsDoctorComparison" class="ai-vs-doctor">
                        <h4 style="margin-bottom: 15px; color: #1976d2;">ğŸ¤– AI vs ğŸ‘¨â€âš•ï¸ ì˜ì‚¬ ì§„ë‹¨ ë¹„êµ</h4>
                        <div class="diagnosis-comparison">
                            <div class="diagnosis-item">
                                <h5>AI ì§„ë‹¨</h5>
                                <div id="aiDiagnosisResult"></div>
                                <small id="aiConfidence"></small>
                            </div>
                            <div class="diagnosis-item">
                                <h5>ì˜ì‚¬ ì§„ë‹¨</h5>
                                <div id="doctorDiagnosisResult"></div>
                            </div>
                        </div>
                        <div id="agreementStatus" class="agreement-status"></div>
                        <div id="doctorNotesDisplay" style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px;"></div>
                    </div>
                    
                    <!-- ì˜ˆì•½ ì™„ë£Œ ì¹´ë“œ -->
                    <div id="appointmentCard" class="appointment-card" style="display: none;">
                        <div class="appointment-confirmed">âœ… ì˜ˆì•½ ì™„ë£Œ</div>
                        <div id="appointmentDetails"></div>
                    </div>
                    
                    <div id="medicalAdvice" class="recommendation-category">
                        <h4>ğŸ¥ ì˜ë£Œ ê´€ë ¨ ê¶Œê³ ì‚¬í•­</h4>
                        <ul class="recommendation-list medical-advice"></ul>
                    </div>
                    
                    <div id="smokingAdvice" class="recommendation-category">
                        <h4>ğŸš­ í¡ì—° ê´€ë ¨ ê¶Œê³ ì‚¬í•­</h4>
                        <ul class="recommendation-list smoking-advice"></ul>
                    </div>
                    
                    <div id="exerciseAdvice" class="recommendation-category">
                        <h4>ğŸƒâ€â™‚ï¸ ìš´ë™ ê´€ë ¨ ê¶Œê³ ì‚¬í•­</h4>
                        <ul class="recommendation-list exercise-advice"></ul>
                    </div>
                    
                    <div id="lifestyleAdvice" class="recommendation-category">
                        <h4>ğŸŒ± ìƒí™œìŠµê´€ ê¶Œê³ ì‚¬í•­</h4>
                        <ul class="recommendation-list lifestyle-advice"></ul>
                    </div>
                    
                    <div id="followupAdvice" class="recommendation-category">
                        <h4>ğŸ“… ì¶”í›„ ê´€ë¦¬ ê³„íš</h4>
                        <ul class="recommendation-list followup-advice"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPredictionResult = null;
        let currentDoctorDiagnosis = null;
        
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const predictButton = document.getElementById('predictButton');
            const fileName = document.getElementById('fileName');
            
            if (file) {
                fileName.textContent = `ì„ íƒëœ íŒŒì¼: ${file.name}`;
                predictButton.disabled = false;
            } else {
                fileName.textContent = '';
                predictButton.disabled = true;
            }
        });
        
        // ì˜ì‚¬ ì§„ë‹¨ í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('doctorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            submitDoctorDiagnosis();
        });
        
        // ë‹¤ìŒ ì§„ë£Œ í•„ìš” ì—¬ë¶€ì— ë”°ë¥¸ ë‚ ì§œ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
        document.querySelectorAll('input[name="next_visit_needed"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const dateGroup = document.getElementById('nextVisitDateGroup');
                const dateInput = document.querySelector('input[name="next_visit_date"]');
                
                if (this.value === 'true') {
                    dateGroup.style.display = 'block';
                    dateInput.required = true;
                    // ìµœì†Œ ë‚ ì§œë¥¼ ë‚´ì¼ë¡œ ì„¤ì •
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    dateInput.min = tomorrow.toISOString().split('T')[0];
                } else {
                    dateGroup.style.display = 'none';
                    dateInput.required = false;
                    dateInput.value = '';
                }
            });
        });
        
        document.getElementById('surveyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            submitSurvey();
        });
        
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 10000);
        }
        
        function showAdminMessage(message) {
            const adminDiv = document.getElementById('adminMessage');
            const adminText = document.getElementById('adminMessageText');
            adminText.textContent = message;
            adminDiv.style.display = 'block';
            
            setTimeout(() => {
                adminDiv.style.display = 'none';
            }, 15000);
        }
        
        async function predict() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showError('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // UI ìƒíƒœ ë³€ê²½
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('doctorSection').style.display = 'none';
            document.getElementById('surveySection').style.display = 'none';
            document.getElementById('recommendationsSection').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('adminMessage').style.display = 'none';
            document.getElementById('predictButton').disabled = true;
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.error) {
                    if (result.admin_notification) {
                        showAdminMessage(result.message || result.error);
                    } else {
                        showError(result.error);
                    }
                    return;
                }
                
                // í˜„ì¬ ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥
                currentPredictionResult = result;
                
                // ê²°ê³¼ í‘œì‹œ
                document.getElementById('predictionResult').textContent = result.prediction;
                document.getElementById('predictionResult').style.color = result.color;
                document.getElementById('confidence').textContent = `ì‹ ë¢°ë„: ${result.confidence}%`;
                
                // ëª¨ë“  ì˜ˆì¸¡ ê²°ê³¼ í‘œì‹œ
                const allPredDiv = document.getElementById('allPredictions');
                allPredDiv.innerHTML = '';
                for (const [className, confidence] of Object.entries(result.all_predictions)) {
                    const div = document.createElement('div');
                    div.className = 'prediction-item';
                    div.innerHTML = `<strong>${className}</strong><br>${confidence}%`;
                    allPredDiv.appendChild(div);
                }
                
                // ì´ë¯¸ì§€ í‘œì‹œ
                document.getElementById('originalImage').src = result.original_image;
                document.getElementById('processedImage').src = result.processed_image;
                if (result.gradcam_image) {
                    document.getElementById('gradcamImage').src = result.gradcam_image;
                }
                
                document.getElementById('resultsSection').style.display = 'block';
                
                // ì˜ì‚¬ ì§„ë‹¨ ì„¹ì…˜ í‘œì‹œ
                if (result.need_doctor_input) {
                    setTimeout(() => {
                        document.getElementById('doctorSection').style.display = 'block';
                        document.getElementById('doctorSection').scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start' 
                        });
                    }, 1000);
                }
                
            } catch (error) {
                showError('ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error('Error:', error);
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('predictButton').disabled = false;
            }
        }
        
        async function submitDoctorDiagnosis() {
            if (!currentPredictionResult) {
                showError('ì§„ë‹¨ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì´ë¯¸ì§€ ì§„ë‹¨ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const formData = new FormData(document.getElementById('doctorForm'));
            const doctorData = {
                ai_result: currentPredictionResult,
                final_diagnosis: formData.get('final_diagnosis'),
                notes: formData.get('notes'),
                next_visit_needed: formData.get('next_visit_needed') === 'true',
                next_visit_date: formData.get('next_visit_date')
            };
            
            try {
                const response = await fetch('/doctor_diagnosis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(doctorData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentDoctorDiagnosis = result.doctor_diagnosis;
                    
                    // ì„¤ë¬¸ì¡°ì‚¬ ì„¹ì…˜ í‘œì‹œ
                    setTimeout(() => {
                        document.getElementById('surveySection').style.display = 'block';
                        
                        // ë‹¤ìŒ ì§„ë£Œê°€ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì˜ˆì•½ í•„ë“œ í‘œì‹œ
                        const appointmentGroup = document.getElementById('appointmentGroup');
                        const appointmentInput = document.getElementById('appointment_date');
                        
                        if (result.doctor_diagnosis.next_visit_needed) {
                            appointmentGroup.style.display = 'block';
                            appointmentInput.required = true;
                            
                            // ê¶Œì¥ ë‚ ì§œê°€ ìˆìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
                            if (result.doctor_diagnosis.next_visit_date) {
                                appointmentInput.value = result.doctor_diagnosis.next_visit_date;
                            }
                            
                            // ìµœì†Œ ë‚ ì§œë¥¼ ë‚´ì¼ë¡œ ì„¤ì •
                            const tomorrow = new Date();
                            tomorrow.setDate(tomorrow.getDate() + 1);
                            appointmentInput.min = tomorrow.toISOString().split('T')[0];
                        } else {
                            // ë‹¤ìŒ ì§„ë£Œê°€ í•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš° ì˜ˆì•½ í•„ë“œ ìˆ¨ê¹€
                            appointmentGroup.style.display = 'none';
                            appointmentInput.required = false;
                            appointmentInput.value = '';
                        }
                        
                        document.getElementById('surveySection').scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start' 
                        });
                    }, 500);
                } else {
                    showError(result.error || 'ì˜ì‚¬ ì§„ë‹¨ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                showError('ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error('Error:', error);
            }
        }
        
        async function submitSurvey() {
            if (!currentPredictionResult || !currentDoctorDiagnosis) {
                showError('ì§„ë‹¨ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì§„í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const formData = new FormData(document.getElementById('surveyForm'));
            const surveyData = {
                prediction_result: currentPredictionResult,
                doctor_diagnosis: currentDoctorDiagnosis,
                smoking: formData.get('smoking') === 'true',
                exercise: parseInt(formData.get('exercise')),
                age: parseInt(formData.get('age')),
                appointment_date: formData.get('appointment_date')
            };
            
            try {
                const response = await fetch('/health_recommendations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(surveyData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayRecommendations(result.recommendations, result.appointment);
                } else {
                    showError(result.error || 'ê¶Œê³ ì‚¬í•­ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                showError('ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error('Error:', error);
            }
        }
        
        function displayRecommendations(recommendations, appointment) {
            // ìš°ì„ ìˆœìœ„ ë°°ë„ˆ ì„¤ì •
            const priorityBanner = document.getElementById('priorityBanner');
            const priorityTexts = {
                'low': 'âœ… ì €ìœ„í—˜êµ° - ì˜ˆë°© ê´€ë¦¬ ì¤‘ì‹¬',
                'medium': 'âš ï¸ ì¤‘ìœ„í—˜êµ° - ì ê·¹ì  ê´€ë¦¬ í•„ìš”',
                'high': 'ğŸš¨ ê³ ìœ„í—˜êµ° - ì‹ ì†í•œ ëŒ€ì‘ í•„ìš”',
                'urgent': 'ğŸ†˜ ê¸´ê¸‰ - ì¦‰ì‹œ ì˜ë£Œì§„ ìƒë‹´ í•„ìš”'
            };
            
            priorityBanner.textContent = priorityTexts[recommendations.priority];
            priorityBanner.className = `priority-banner priority-${recommendations.priority}`;
            
            // AI vs ì˜ì‚¬ ì§„ë‹¨ ë¹„êµ í‘œì‹œ
            const aiVsDoctor = recommendations.ai_vs_doctor;
            document.getElementById('aiDiagnosisResult').textContent = aiVsDoctor.ai_diagnosis;
            document.getElementById('aiConfidence').textContent = `(ì‹ ë¢°ë„: ${aiVsDoctor.ai_confidence}%)`;
            document.getElementById('doctorDiagnosisResult').textContent = aiVsDoctor.doctor_diagnosis;
            
            const agreementStatus = document.getElementById('agreementStatus');
            if (aiVsDoctor.agreement) {
                agreementStatus.textContent = 'âœ… AIì™€ ì˜ì‚¬ ì§„ë‹¨ì´ ì¼ì¹˜í•©ë‹ˆë‹¤';
                agreementStatus.className = 'agreement-status agreement-true';
            } else {
                agreementStatus.textContent = 'âš ï¸ AIì™€ ì˜ì‚¬ ì§„ë‹¨ì´ ë‹¤ë¦…ë‹ˆë‹¤ (ì˜ì‚¬ ì§„ë‹¨ì„ ìš°ì„ ì ìš©)';
                agreementStatus.className = 'agreement-status agreement-false';
            }
            
            // ì˜ì‚¬ ì†Œê²¬ í‘œì‹œ
            const doctorNotesDisplay = document.getElementById('doctorNotesDisplay');
            if (recommendations.doctor_notes) {
                doctorNotesDisplay.innerHTML = `<strong>ì˜ì‚¬ ì†Œê²¬:</strong> ${recommendations.doctor_notes}`;
                doctorNotesDisplay.style.display = 'block';
            } else {
                doctorNotesDisplay.style.display = 'none';
            }
            
            // ì˜ˆì•½ ì •ë³´ í‘œì‹œ
            if (appointment && appointment.date) {
                const appointmentCard = document.getElementById('appointmentCard');
                const appointmentDetails = document.getElementById('appointmentDetails');
                
                appointmentDetails.textContent = appointment.message;
                appointmentCard.style.display = 'block';
            }
            
            // ê° ì¹´í…Œê³ ë¦¬ë³„ ê¶Œê³ ì‚¬í•­ í‘œì‹œ
            const categories = [
                { id: 'medicalAdvice', key: 'medical_advice' },
                { id: 'smokingAdvice', key: 'smoking_advice' },
                { id: 'exerciseAdvice', key: 'exercise_advice' },
                { id: 'lifestyleAdvice', key: 'lifestyle_advice' },
                { id: 'followupAdvice', key: 'followup_advice' }
            ];
            
            categories.forEach(category => {
                const adviceList = recommendations[category.key] || [];
                const listElement = document.querySelector(`#${category.id} .recommendation-list`);
                
                if (adviceList.length > 0) {
                    listElement.innerHTML = '';
                    adviceList.forEach(advice => {
                        const li = document.createElement('li');
                        li.textContent = advice;
                        listElement.appendChild(li);
                    });
                    document.getElementById(category.id).style.display = 'block';
                } else {
                    document.getElementById(category.id).style.display = 'none';
                }
            });
            
            // ê¶Œê³ ì‚¬í•­ ì„¹ì…˜ í‘œì‹œ ë° ìŠ¤í¬ë¡¤
            document.getElementById('recommendationsSection').style.display = 'block';
            setTimeout(() => {
                document.getElementById('recommendationsSection').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 300);
        }
    </script>
</body>
</html>
